@using Backoffice0._1.Models
@model Backoffice0._1.Models.UsuarioListaViewModel
@{
                /**/

                ViewBag.Title = "Configuracion";
                Layout = "~/Views/Shared/MainLayout.cshtml";

}

<h2>Configuracion</h2>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<header id="header">
    <div class="w3-bar w3-dark-grey">
        <nav id="nav">

            @Html.ActionLink("Modulos", "Index", "MODULOS", null, new { @class = "w3-bar-item w3-button" })
            @*<a href="~/Views/MODULOS/Index.cshtml" class="w3-bar-item w3-button">Modulos</a>*@
            @Html.ActionLink("Perfiles", "Index", "PERFILES", null, new { @class = "w3-bar-item w3-button" })
            @Html.ActionLink("Permisos", "Index", "PERMISOS", null, new { @class = "w3-bar-item w3-button" })
            @Html.ActionLink("Roles", "Index", "ROLES", null, new { @class = "w3-bar-item w3-button" })
            @Html.ActionLink("Usuarios", "Index", "USUARIOS", null, new { @class = "w3-bar-item w3-button" })
            @Html.ActionLink("Configuracion", "Configuracion", "Configuracion", null, new { @class = "w3-bar-item w3-button" })
        </nav>
    </div>
</header>
<style>
    .MakeWide {
        font-size: small
    }
</style>

<br />
<br />
<label class="MakeWide">
    Configuración de seguridad<br />
    <br />

    Usuario: @ViewBag.Nombre

    @using (Html.BeginForm("UserSelected", "Configuracion", FormMethod.Post))
    {
        @Html.AntiForgeryToken();

        @Html.DropDownListFor(Model => Model.SelectIdUsuario, new SelectList(Model.Usuarios, "ID_USUARIO", "NOMBRE", Model.Nombre), new { @id = "SelID" })


        <input type="submit" value="submit" />
    }
    <script type="text/javascript">
        $(document).ready(function () {
            $("#SelID").val($("#SelID option:selected").text());

        });
    </script>

    Perfil: @ViewBag.DescripcionPerfil
    &nbsp;&nbsp;&nbsp;&nbsp; Rol: @ViewBag.DescripcionRol

    <script type="text/javascript">

        //function showalert() {
        //    var userId = $('#SelectIdUsuario').val();
        //    alert('You Clicked Button ' + userId);
        //}
        function SelectIndexChange() {
            var userId = $('#SelectIdUsuario').val();

            $.ajax({
                url: '/Configuracion/testing',
                type: "POST",
                dataType: "JSON",
                data: { userId: userId },
                //success: function (data) {
                //    alert(data);

                //}

            });

        }
    </script>


</label>


<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">


    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="//code.jquery.com/jquery-2.2.4.min.js"></script>
    <link href="//cdn.jsdelivr.net/npm/jquery.fancytree@2.27/dist/skin-win8/ui.fancytree.min.css" rel="stylesheet">
    <script src="//cdn.jsdelivr.net/npm/jquery.fancytree@2.27/dist/jquery.fancytree-all-deps.min.js"></script>
    <link href="../src/skin-win8/ui.fancytree.css" rel="stylesheet">
    <script src="../src/jquery.fancytree.js"></script>
    <script type="text/javascript">
        var permisos
        var selKeys
        var modulo
        $(function () {

            // --- Initialize sample trees


            // ---------------------------------------------------------------------


            $("#tree2").fancytree({
                checkbox: true,
                selectMode: 2,
                source: [
                    {
                        title: "Inventario", expanded: false, checkbox: false, selected: false
                    },
                    {
                        title: "Almacen", expanded: false, checkbox: false, selected: false
                    },
                    {
                        title: "Ventas", expanded: false, checkbox: false, selected: false
                    },
                    {
                        title: "Clientes", expanded: false, checkbox: false, selected: false
                    },
                    {
                        title: "Proveedores", expanded: false, checkbox: false, selected: false
                    }
                ],

                //init: function (event, data) {
                // Set key from first part of title (just for this demo output)
                //       data.tree.visit(function (n) {

                //           n.key = n.title.split(" ")[0];

                //});
                //},

                activate: function (event, data) {
                    $("#echoActive1").text(data.node.title);
                    modulo = (data.node.title);
                },

                select: function (event, data) {
                    // Display list of selected nodes
                    var selNodes = data.tree.getSelectedNodes();
                    // convert to title/key array
                    var selKeys = $.map(selNodes, function (node) {
                        return "'" + node.title + "'";
                    });
                    $("#echoSelection2").text(selKeys.join(", "));
                },
                // The following options are only required, if we have more than one tree on one page:
                cookieId: "fancytree-Cb2",
                idPrefix: "fancytree-Cb2-"
            });

        });

        $(function () {

            $("#tree3").fancytree({
                checkbox: true,

                selectMode: 2,
                source: [
                    {
                        title: "Guardar", checkbox: true, selected: false
                    },
                    {
                        title: "Editar", checkbox: true, selected: false
                    },
                    {
                        title: "Eliminar", checkbox: true, selected: false
                    },
                    {
                        title: "Cancelar", checkbox: true, selected: false
                    },
                    {
                        title: "Exportar", checkbox: true, selected: false
                    },
                    {
                        title: "Imprimir", checkbox: true, selected: false
                    },
                    {
                        title: "Ocultar", checkbox: true, selected: false
                    }
                ],

                //init: function (event, data) {
                // Set key from first part of title (just for this demo output)
                //       data.tree.visit(function (n) {

                //           n.key = n.title.split(" ")[0];

                //});
                //},


                select: function (event, data) {
                    // Display list of selected nodes
                    var selNodes = data.tree.getSelectedNodes();
                    // convert to title/key array
                     selKeys = $.map(selNodes, function (node) {
                        return "'" + node.title + "'";
                    });
                    $("#echoSelection2").text(selKeys.join(", "));




                },


            });

        });
        var descPerfil = '@ViewBag.DescripcionPerfil'
       var descRol = '@ViewBag.DescripcionRol'
        var descNombre = '@ViewBag.Nombre'
        function foo() {


            permisos = selKeys.join(", ")
            alert("asdad" + permisos + descNombre + modulo)
            $.ajax({
                url: '/Configuracion/GuardarPermisos',
                type: "GET",
                contentType: 'application/json',
                data: { param1: permisos, perfil: descPerfil, rol: descRol, nombre: descNombre, modulo: modulo },
               success: alert("Datos Guardados")

            });

            return true;
    if(null != TempData["alertMessage"])
   {
      
        alert(TempData["alertMessage"]);
   
    }
    }

    </script>
</head>
<body>

    <table>
        <tr>
            <th>
                <div id="tree2">
                    <p>Modulos:</p>
                </div>
            </th>
            <th>
                <br /><br /><div id="tree3">
                    <p>Permisos:</p>
                </div>
            </th>
        </tr>
        <tr>
            <th>
                <div>Modulo seleccionado: <span id="echoActive1">-</span></div>
                <div>Permisos: <span id="echoSelection2">-</span></div>
                <div>
                 
                <input type="submit" value="Guardar" onclick="return foo()" />
                
                <script type="text/javascript">
                   
                 
                    
                </script>
                    @*  @Html.Partial("~/UserControls/barra.cshtml")*@
                </div>
            </th>
        </tr>
    </table>
</body>
</html>


